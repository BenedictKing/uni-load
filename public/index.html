<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>uni-load - AIç«™ç‚¹é…ç½®å™¨</title>
    <link rel="icon" href="/logo.svg" type="image/svg+xml" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
        padding: 30px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .form-container {
        padding: 40px;
      }

      .form-group {
        margin-bottom: 25px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
        font-size: 1.1em;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 15px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: #f8f9fa;
      }

      /* APIåŸºç¡€åœ°å€è¾“å…¥æ¡†å®¹å™¨æ ·å¼ */
      .input-with-badge {
        position: relative;
        display: flex;
        align-items: center;
      }

      .input-with-badge input {
        flex: 1;
        padding-right: 120px; /* ä¸ºå³ä¾§èƒ¶å›Šç•™å‡ºç©ºé—´ */
      }

      /* ç«™ç‚¹åç§°èƒ¶å›Šæ ·å¼ */
      .site-name-badge {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
        max-width: 100px;
        overflow: hidden;
        text-overflow: ellipsis;
        transition: all 0.3s ease;
        pointer-events: none;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
      }

      .site-name-badge.loading {
        background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%);
        box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
      }

      .site-name-badge.error {
        background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #4caf50;
        background: white;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
      }

      .form-group textarea {
        height: 120px;
        resize: vertical;
        font-family: 'Courier New', monospace;
      }

      .btn-submit {
        width: 100%;
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
        border: none;
        padding: 18px;
        border-radius: 12px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
        box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
      }

      .btn-submit:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(86, 171, 47, 0.4);
      }

      .btn-submit:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }

      .result {
        margin-top: 30px;
        padding: 20px;
        border-radius: 10px;
        display: none;
      }

      .result.success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border: 1px solid #c3e6cb;
        color: #155724;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
      }

      .result.error {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        border: 1px solid #f5c6cb;
        color: #721c24;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
      }

      .loading {
        text-align: center;
        padding: 20px;
        display: none;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4caf50;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .help-text {
        font-size: 0.9em;
        color: #6c757d;
        margin-top: 5px;
      }

      .example {
        background: #e9ecef;
        padding: 10px;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        margin-top: 5px;
      }

      .checkbox-group {
        margin-top: 10px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: normal;
        font-size: 16px;
        white-space: nowrap;
      }

      .checkbox-item input[type='checkbox'] {
        margin-right: 12px;
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .checkbox-item:hover {
        background: #f8f9fa;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      .sync-panel {
        margin-top: 40px;
        padding: 25px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        border: 1px solid #dee2e6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }

      .sync-panel:hover {
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .sync-panel h3 {
        margin-bottom: 20px;
        color: #495057;
        font-weight: 600;
      }

      .sync-status {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .sync-controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .btn-sync,
      .btn-control,
      .btn-refresh,
      .btn-warning {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-sync {
        background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(23, 162, 184, 0.3);
      }

      .btn-sync:hover {
        background: linear-gradient(135deg, #138496 0%, #1ba085 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(23, 162, 184, 0.4);
      }

      .btn-control {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        color: #212529;
        box-shadow: 0 2px 4px rgba(255, 193, 7, 0.3);
      }

      .btn-control:hover {
        background: linear-gradient(135deg, #e0a800 0%, #e8590c 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(255, 193, 7, 0.4);
      }

      .btn-refresh {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(108, 117, 125, 0.3);
      }

      .btn-refresh:hover {
        background: linear-gradient(135deg, #545b62 0%, #343a40 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(108, 117, 125, 0.4);
      }

      .btn-warning {
        background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
      }

      .btn-warning:hover {
        background: linear-gradient(135deg, #c82333 0%, #e8590c 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(111, 66, 193, 0.3);
      }

      .btn-secondary:hover {
        background: linear-gradient(135deg, #5a32a3 0%, #d91a72 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(111, 66, 193, 0.4);
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
        position: relative;
      }

      /* è¿è¡ŒçŠ¶æ€ - ç»¿è‰²è„‰å†² */
      .status-running {
        background: #28a745;
        animation: pulse-green 2s infinite;
      }

      .status-running::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: #28a745;
        animation: pulse-ring 2s infinite;
      }

      /* åœæ­¢çŠ¶æ€ - çº¢è‰² */
      .status-stopped {
        background: #dc3545;
        animation: pulse-red 3s infinite;
      }

      /* ç©ºé—²çŠ¶æ€ - é»„è‰²è„‰å†² */
      .status-idle {
        background: #ffc107;
        animation: pulse-yellow 2.5s infinite;
      }

      /* è„‰å†²åŠ¨ç”» */
      @keyframes pulse-green {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }

      @keyframes pulse-red {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      @keyframes pulse-yellow {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      @keyframes pulse-ring {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        100% {
          transform: scale(1.8);
          opacity: 0;
        }
      }
      /* æ¸ é“åˆ—è¡¨æ ·å¼ */
      .channels-list {
        margin-top: 1rem;
      }

      /* å•ä¸ªæ¸ é“é¡¹ç›®æ ·å¼ */
      .channel-item {
        display: flex;
        flex-direction: column;
        padding: 1.2rem;
        border: 1px solid #e1e5e9;
        border-radius: 12px;
        background: white;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .channel-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        opacity: 0.7;
        transition: all 0.3s ease;
      }

      /* OpenAI æ¸ é“å¡ç‰‡ - ç»¿è‰²è¾¹æ¡† */
      .channel-item[data-channel-type="openai"]::before,
      .channel-item:has(.channel-type-badge.openai)::before {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }

      /* Anthropic æ¸ é“å¡ç‰‡ - ç´«è‰²è¾¹æ¡† */
      .channel-item[data-channel-type="anthropic"]::before,
      .channel-item:has(.channel-type-badge.anthropic)::before {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      }

      /* Gemini æ¸ é“å¡ç‰‡ - è“è‰²è¾¹æ¡† */
      .channel-item[data-channel-type="gemini"]::before,
      .channel-item:has(.channel-type-badge.gemini)::before {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      }

      .channel-item:hover::before {
        opacity: 1;
        width: 6px;
      }

      .channel-item:hover {
        background: #f8f9fa;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
      }

      .channel-info {
        flex: 1;
        min-width: 0; /* å…è®¸å†…å®¹æˆªæ–­ */
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
      }

      .channel-name {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 0.3rem;
        flex-wrap: wrap;
      }

      .channel-name strong {
        color: #2c3e50;
        font-size: 1.15em;
        font-weight: 600;
        flex: 1;
        min-width: 200px;
      }

      /* æ¸ é“ç±»å‹æ ‡è®°åŸºç¡€æ ·å¼ */
      .channel-type-badge {
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 6px;
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      /* OpenAI æ¸ é“ç±»å‹ - ç»¿è‰²ä¸»é¢˜ */
      .channel-type-badge.openai,
      .channel-type-badge[data-type="openai"] {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
      }

      .channel-type-badge.openai:hover,
      .channel-type-badge[data-type="openai"]:hover {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
      }

      /* Anthropic æ¸ é“ç±»å‹ - ç´«è‰²ä¸»é¢˜ */
      .channel-type-badge.anthropic,
      .channel-type-badge[data-type="anthropic"] {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);
      }

      .channel-type-badge.anthropic:hover,
      .channel-type-badge[data-type="anthropic"]:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(139, 92, 246, 0.4);
      }

      /* Gemini æ¸ é“ç±»å‹ - è“è‰²ä¸»é¢˜ */
      .channel-type-badge.gemini,
      .channel-type-badge[data-type="gemini"] {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
      }

      .channel-type-badge.gemini:hover,
      .channel-type-badge[data-type="gemini"]:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
      }

      /* å…¶ä»–æ¸ é“ç±»å‹ - ç°è‰²ä¸»é¢˜ */
      .channel-type-badge.default,
      .channel-type-badge:not(.openai):not(.anthropic):not(.gemini):not([data-type]) {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        box-shadow: 0 2px 4px rgba(107, 114, 128, 0.3);
      }

      .channel-type-badge.default:hover,
      .channel-type-badge:not(.openai):not(.anthropic):not(.gemini):not([data-type]):hover {
        background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(107, 114, 128, 0.4);
      }

      .channel-details {
        display: flex;
        gap: 1.2rem;
        flex-wrap: wrap;
        font-size: 0.9em;
        color: #6c757d;
        background: #f8f9fa;
        padding: 0.8rem;
        border-radius: 8px;
        border-left: 3px solid #e9ecef;
      }

      .detail-item {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }

      .detail-item::before {
        content: 'â€¢';
        color: #adb5bd;
        font-weight: bold;
      }

      .detail-item:first-child::before {
        content: '';
      }

      .channel-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        margin-top: 0.8rem;
        padding-top: 0.8rem;
        border-top: 1px solid #e9ecef;
        flex-wrap: wrap;
      }

      .channel-action-group {
        display: flex;
        gap: 0.6rem;
        align-items: center;
      }

      .channel-reassign-group {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        padding: 0.5rem 0.8rem;
        border-radius: 10px;
        border: 1px solid #90caf9;
        box-shadow: 0 2px 4px rgba(33, 150, 243, 0.1);
      }

      .channel-management-group {
        display: flex;
        gap: 0.6rem;
      }

      .btn-update {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2);
      }

      .btn-update:hover {
        background: linear-gradient(135deg, #218838 0%, #1ba085 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
      }

      .btn-delete {
        background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.2);
      }

      .btn-delete:hover {
        background: linear-gradient(135deg, #c82333 0%, #e8590c 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
      }

      .btn-promote,
      .btn-demote {
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .btn-promote {
        background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
        color: white;
      }

      .btn-promote:hover {
        background: linear-gradient(135deg, #138496 0%, #1ba085 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
      }

      .btn-demote {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        color: #212529;
      }

      .btn-demote:hover {
        background: linear-gradient(135deg, #e0a800 0%, #e8590c 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
      }

      /* æŒ‰é’®ç¦ç”¨çŠ¶æ€ */
      .btn-update:disabled,
      .btn-delete:disabled,
      .btn-promote:disabled,
      .btn-demote:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .channel-item {
          padding: 1rem;
          margin-bottom: 0.8rem;
        }

        .channel-info {
          gap: 0.6rem;
        }

        .channel-name {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
          margin-bottom: 0.2rem;
        }

        .channel-name strong {
          min-width: auto;
          font-size: 1.1em;
        }

        .channel-details {
          flex-direction: column;
          gap: 0.5rem;
          padding: 0.6rem;
        }

        .channel-actions {
          flex-direction: column;
          gap: 0.8rem;
          align-items: stretch;
        }

        .channel-action-group {
          justify-content: center;
          gap: 0.5rem;
        }

        .detail-item {
          overflow: visible;
          white-space: normal;
        }

        .btn-update,
        .btn-delete,
        .btn-promote,
        .btn-demote {
          padding: 0.5rem 1rem;
          font-size: 0.85em;
        }
      }

      /* è¶…å°å±å¹•é€‚é… */
      @media (max-width: 480px) {
        .channel-item {
          padding: 0.8rem;
        }

        .channel-name {
          font-size: 1em;
        }

        .channel-actions {
          gap: 0.6rem;
        }

        .channel-action-group {
          flex-direction: column;
          gap: 0.4rem;
        }

        .btn-update,
        .btn-delete,
        .btn-promote,
        .btn-demote {
          width: 100%;
          text-align: center;
        }
      }

      /* æ¨¡æ€æ¡†æ ·å¼ */
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e1e5e9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
        border-radius: 15px 15px 0 0;
      }

      .modal-header h3 {
        margin: 0;
        color: #333;
      }

      .close {
        font-size: 24px;
        cursor: pointer;
        color: #666;
        background: none;
        border: none;
      }

      .close:hover {
        color: #000;
      }

      .modal-body {
        padding: 1.5rem;
      }

      .info-display {
        background: #f8f9fa;
        padding: 0.8rem;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        border: 1px solid #e1e5e9;
        color: #495057;
      }

      .modal-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .btn-primary {
        background: #4caf50;
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        flex: 1;
      }

      .btn-primary:hover {
        background: #45a049;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        flex: 1;
      }

      .btn-secondary:hover {
        background: #545b62;
      }

      /* æŠ˜å åŒºåŸŸæ ·å¼ */
      .collapsible-section {
        margin-bottom: 25px;
      }

      .collapsible-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 12px 15px;
        background: #f8f9fa;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        transition: all 0.3s ease;
        user-select: none;
      }

      .collapsible-header:hover {
        background: #e9ecef;
        border-color: #ced4da;
      }

      .collapsible-header label {
        margin: 0;
        cursor: pointer;
        font-weight: 600;
        color: #555;
        font-size: 1.1em;
      }

      .collapsible-toggle {
        font-size: 18px;
        font-weight: bold;
        color: #6c757d;
        transition: transform 0.3s ease;
        min-width: 20px;
        text-align: center;
      }

      .collapsible-content {
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
        max-height: 0;
        padding: 0 15px;
      }

      .collapsible-content.expanded {
        max-height: 200px; /* è¶³å¤Ÿé«˜ä»¥å®¹çº³textarea */
        padding: 15px;
      }

      .collapsible-header.expanded .collapsible-toggle {
        transform: rotate(180deg);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸš€ uni-load</h1>
        <p>AIç«™ç‚¹è‡ªåŠ¨é…ç½®å·¥å…· - è¿æ¥ uni-api ä¸ gpt-load</p>
      </div>

      <div class="form-container">
        <form id="aiSiteForm">
          <div class="form-group">
            <label for="baseUrl">API åŸºç¡€åœ°å€ *</label>
            <div class="input-with-badge">
              <input
                type="url"
                id="baseUrl"
                name="baseUrl"
                required
                placeholder="https://api.example.com"
                oninput="debouncedUpdateSiteName()" />
              <span id="generatedSiteName" class="site-name-badge loading">
                è¯·è¾“å…¥åœ°å€
              </span>
            </div>
            <div class="help-text">AIç«™ç‚¹çš„APIåœ°å€ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆç«™ç‚¹åç§°</div>
          </div>

          <div class="form-group">
            <label>API æ ¼å¼ç±»å‹ * (å¯å¤šé€‰)</label>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input
                  type="checkbox"
                  id="channelType_openai"
                  name="channelTypes"
                  value="openai"
                  checked
                  onchange="updateValidationEndpointHelp()" />
                <span class="checkmark"></span>
                OpenAI å…¼å®¹æ ¼å¼
              </label>
              <label class="checkbox-item">
                <input
                  type="checkbox"
                  id="channelType_anthropic"
                  name="channelTypes"
                  value="anthropic"
                  onchange="updateValidationEndpointHelp()" />
                <span class="checkmark"></span>
                Anthropic Claude æ ¼å¼
              </label>
              <label class="checkbox-item">
                <input
                  type="checkbox"
                  id="channelType_gemini"
                  name="channelTypes"
                  value="gemini"
                  onchange="updateValidationEndpointHelp()" />
                <span class="checkmark"></span>
                Google Gemini æ ¼å¼
              </label>
            </div>
            <div class="help-text">é€‰æ‹©è¯¥AIç«™ç‚¹æ”¯æŒçš„APIæ ¼å¼</div>
          </div>

          <div class="form-group">
            <label for="apiKeys">API å¯†é’¥ *</label>
            <textarea
              id="apiKeys"
              name="apiKeys"
              required
              placeholder="sk-xxx...&#10;sk-yyy..., sk-zzz...&#10;sk-aaa... sk-bbb...; sk-ccc...&#10;&#10;æ”¯æŒåˆ†éš”ç¬¦ï¼šæ¢è¡Œã€ç©ºæ ¼ã€é€—å·ã€åˆ†å·"
              rows="6"></textarea>
          </div>

          <!-- æ‰‹åŠ¨æŒ‡å®šæ¨¡å‹ - å¯æŠ˜å åŒºåŸŸ -->
          <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleCollapsible('manualModelsSection')">
              <label>æ‰‹åŠ¨æŒ‡å®šæ¨¡å‹ (å¯é€‰)</label>
              <span class="collapsible-toggle">â–¼</span>
            </div>
            <div id="manualModelsSection" class="collapsible-content">
              <div class="form-group" style="margin-bottom: 10px;">
                <textarea
                  id="manualModels"
                  name="manualModels"
                  placeholder="å¦‚æœç«™ç‚¹æ— æ³•è‡ªåŠ¨è·å–æ¨¡å‹åˆ—è¡¨ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š&#10;gpt-3.5-turbo&#10;gpt-4&#10;claude-3-sonnet&#10;deepseek-chat&#10;&#10;æ¯è¡Œä¸€ä¸ªæ¨¡å‹åç§°"
                  rows="4"></textarea>
                <div class="help-text">ä»…å½“è‡ªåŠ¨è·å–æ¨¡å‹å¤±è´¥æ—¶ä½¿ç”¨ã€‚æ¯è¡Œä¸€ä¸ªæ¨¡å‹åç§°ã€‚</div>
              </div>
            </div>
          </div>

          <!-- æ–°çš„åŠ¨æ€éªŒè¯ç«¯ç‚¹è¾“å…¥åŒºåŸŸ -->
          <div id="validationEndpointsContainer">
            <div id="validationEndpoint_openai_group" class="form-group" style="display: none">
              <label for="validationEndpoint_openai">éªŒè¯ç«¯ç‚¹ (OpenAI æ ¼å¼)</label>
              <input
                type="text"
                id="validationEndpoint_openai"
                name="validationEndpoint_openai"
                placeholder="ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼ /v1/chat/completions" />
              <div class="help-text">ç”¨äº OpenAI æ ¼å¼çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ã€‚</div>
            </div>
            <div id="validationEndpoint_anthropic_group" class="form-group" style="display: none">
              <label for="validationEndpoint_anthropic">éªŒè¯ç«¯ç‚¹ (Claude æ ¼å¼)</label>
              <input
                type="text"
                id="validationEndpoint_anthropic"
                name="validationEndpoint_anthropic"
                placeholder="ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼ /v1/messages" />
              <div class="help-text">ç”¨äº Anthropic Claude æ ¼å¼çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ã€‚</div>
            </div>
            <div id="validationEndpoint_gemini_group" class="form-group" style="display: none">
              <label for="validationEndpoint_gemini">éªŒè¯ç«¯ç‚¹ (Gemini æ ¼å¼)</label>
              <input
                type="text"
                id="validationEndpoint_gemini"
                name="validationEndpoint_gemini"
                placeholder="ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼ /v1beta/models" />
              <div class="help-text">ç”¨äº Google Gemini æ ¼å¼çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ã€‚</div>
            </div>
          </div>

          <button type="submit" class="btn-submit" id="submitBtn">ğŸ”§ å¼€å§‹é…ç½®</button>
        </form>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>æ­£åœ¨é…ç½®ä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>

        <div class="result" id="result"></div>

        <!-- æ¨¡å‹åŒæ­¥æ§åˆ¶é¢æ¿ -->
        <div class="sync-panel">
          <h3>ğŸ”„ æ¨¡å‹åŒæ­¥æœåŠ¡</h3>
          <div class="sync-status" id="syncStatus">
            <p>æ­£åœ¨è·å–çŠ¶æ€...</p>
          </div>
          <div class="sync-controls">
            <button type="button" class="btn-sync" onclick="triggerManualSync()">
              ğŸ”„ æ‰‹åŠ¨åŒæ­¥
            </button>
            <button type="button" class="btn-control" id="syncControlBtn" onclick="toggleSyncService()">
              âš™ï¸ æ§åˆ¶æœåŠ¡
            </button>
            <button type="button" class="btn-refresh" onclick="refreshSyncStatus()">
              ğŸ”„ åˆ·æ–°çŠ¶æ€
            </button>
            <button type="button" class="btn-warning" onclick="cleanupAndResetModels()">
              ğŸ—‘ï¸ æ¸…ç†é‡ç½®
            </button>
          </div>
        </div>

        <!-- ä¸´æ—¶åˆ†ç»„æ¸…ç†é¢æ¿ -->
        <div class="sync-panel">
          <h3>ğŸ§¹ ä¸´æ—¶åˆ†ç»„æ¸…ç†</h3>
          <div class="sync-status" id="tempGroupsStatus">
            <p>æ­£åœ¨è·å–ç»Ÿè®¡...</p>
          </div>
          <div class="sync-controls">
            <button type="button" class="btn-refresh" onclick="refreshTempGroupsStats()">
              ğŸ“Š åˆ·æ–°ç»Ÿè®¡
            </button>
            <button type="button" class="btn-warning" onclick="cleanupAllTempGroups()">
              ğŸ—‘ï¸ æ¸…ç†æ‰€æœ‰åˆ†ç»„
            </button>
            <button type="button" class="btn-secondary" onclick="cleanupOldTempGroups()">
              â° æ¸…ç†24å°æ—¶å‰
            </button>
          </div>
        </div>

        <!-- æ¸ é“å¥åº·ç›‘æ§é¢æ¿ -->
        <div class="sync-panel">
          <h3>ğŸ©º æ¸ é“å¥åº·ç›‘æ§</h3>
          <div class="sync-status" id="channelHealthStatus">
            <p>æ­£åœ¨è·å–çŠ¶æ€...</p>
          </div>
          <div class="sync-controls">
            <button type="button" class="btn-sync" onclick="triggerChannelCheck()">
              â¤ï¸ å¥åº·æ£€æŸ¥
            </button>
            <button type="button" class="btn-control" id="healthControlBtn" onclick="toggleHealthMonitor()">
              âš™ï¸ æ§åˆ¶æœåŠ¡
            </button>
            <button type="button" class="btn-warning" onclick="showFailedChannels()">
              âš ï¸ æŸ¥çœ‹å¤±è´¥æ¸ é“
            </button>
            <button type="button" class="btn-refresh" onclick="refreshChannelHealthStatus()">
              ğŸ”„ åˆ·æ–°çŠ¶æ€
            </button>
          </div>
          <!-- æ–°å¢ä¸€ä¸ªç”¨äºæ˜¾ç¤ºæ¸ é“åˆ—è¡¨çš„å®¹å™¨ -->
          <div id="channelListContainer" style="margin-top: 15px"></div>
        </div>
      </div>
    </div>
    <!-- æ›´æ–°æ¸ é“æ¨¡æ€æ¡† -->
    <div id="updateChannelModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ”„ æ›´æ–°æ¸ é“é…ç½®</h3>
          <span class="close" onclick="closeUpdateModal()">&times;</span>
        </div>
        <div class="modal-body">
          <form id="updateChannelForm">
            <input type="hidden" id="updateChannelName" />
            <input type="hidden" id="updateOriginalBaseUrl" />
            <input type="hidden" id="updateChannelType" />

            <div class="form-group">
              <label>æ¸ é“åç§°ï¼š</label>
              <div class="info-display" id="updateChannelDisplayName"></div>
            </div>

            <div class="form-group">
              <label>åŸå§‹åœ°å€ï¼š</label>
              <div class="info-display" id="updateBaseUrlDisplay"></div>
            </div>

            <div class="form-group">
              <label for="updateApiKeys">ğŸ”‘ API å¯†é’¥ (å¯é€‰)</label>
              <textarea
                id="updateApiKeys"
                placeholder="ç•™ç©ºåˆ™ä¿æŒç°æœ‰å¯†é’¥ä¸å˜&#10;å¦‚éœ€æ·»åŠ æ–°å¯†é’¥ï¼Œè¯·è¾“å…¥:&#10;sk-xxx...&#10;sk-yyy..."
                rows="4"></textarea>
              <div class="help-text">ç•™ç©ºåˆ™ä¿æŒç°æœ‰APIå¯†é’¥ä¸å˜ï¼Œå¡«å†™åˆ™ä¼šæ·»åŠ æ–°çš„å¯†é’¥åˆ°ç°æœ‰å¯†é’¥ä¸­</div>
            </div>

            <div class="modal-actions">
              <button type="submit" class="btn-primary">ğŸ”„ æ›´æ–°é…ç½®</button>
              <button type="button" class="btn-secondary" onclick="closeUpdateModal()">å–æ¶ˆ</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      // è‡ªåŠ¨ç”Ÿæˆç«™ç‚¹åç§° - é€šè¿‡åç«¯API
      async function updateSiteName() {
        const baseUrlInput = document.getElementById('baseUrl')
        const siteNameBadge = document.getElementById('generatedSiteName')
        const baseUrl = baseUrlInput.value.trim()

        if (!baseUrl) {
          siteNameBadge.textContent = 'è¯·è¾“å…¥åœ°å€'
          siteNameBadge.className = 'site-name-badge loading'
          return
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        siteNameBadge.textContent = 'ç”Ÿæˆä¸­...'
        siteNameBadge.className = 'site-name-badge loading'

        try {
          // è°ƒç”¨åç«¯APIè·å–ç«™ç‚¹åç§°
          const response = await fetch('/api/preview-site-name', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ baseUrl }),
          })

          const data = await response.json()

          if (response.ok) {
            siteNameBadge.textContent = data.siteName
            siteNameBadge.className = 'site-name-badge'
            siteNameBadge.title = `ç«™ç‚¹åç§°: ${data.siteName}` // æ·»åŠ tooltipæ˜¾ç¤ºå®Œæ•´åç§°
          } else {
            siteNameBadge.textContent = 'ç”Ÿæˆå¤±è´¥'
            siteNameBadge.className = 'site-name-badge error'
            siteNameBadge.title = data.error || 'æ— æ³•ç”Ÿæˆç«™ç‚¹åç§°'
          }
        } catch (error) {
          siteNameBadge.textContent = 'ç½‘ç»œé”™è¯¯'
          siteNameBadge.className = 'site-name-badge error'
          siteNameBadge.title = 'ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•ç”Ÿæˆç«™ç‚¹åç§°'
        }
      }

      // é˜²æŠ–å‡½æ•°ï¼Œé¿å…é¢‘ç¹è°ƒç”¨API
      let debounceTimer
      function debouncedUpdateSiteName() {
        clearTimeout(debounceTimer)
        debounceTimer = setTimeout(updateSiteName, 500) // 500ms å»¶è¿Ÿ
      }

      // æŠ˜å /å±•å¼€åŠŸèƒ½
      function toggleCollapsible(sectionId) {
        const content = document.getElementById(sectionId)
        const header = content.previousElementSibling
        
        if (content.classList.contains('expanded')) {
          // æ”¶èµ·
          content.classList.remove('expanded')
          header.classList.remove('expanded')
        } else {
          // å±•å¼€
          content.classList.add('expanded')
          header.classList.add('expanded')
        }
      }

      // åŠ¨æ€æ›´æ–°éªŒè¯ç«¯ç‚¹çš„å¸®åŠ©ä¿¡æ¯
      function updateValidationEndpointHelp() {
        const checkedTypes = Array.from(document.querySelectorAll('input[name="channelTypes"]:checked')).map(
          (cb) => cb.value
        )
        const allTypes = ['openai', 'anthropic', 'gemini']

        allTypes.forEach((type) => {
          const groupDiv = document.getElementById(`validationEndpoint_${type}_group`)
          if (groupDiv) {
            if (checkedTypes.includes(type)) {
              groupDiv.style.display = 'block'
            } else {
              groupDiv.style.display = 'none'
            }
          }
        })
      }

      function addApiKey() {
        // è¿™ä¸ªå‡½æ•°ä¸å†éœ€è¦ï¼Œä½†ä¿ç•™ä»¥é˜²æ­¢é”™è¯¯
      }

      function removeApiKey(button) {
        // è¿™ä¸ªå‡½æ•°ä¸å†éœ€è¦ï¼Œä½†ä¿ç•™ä»¥é˜²æ­¢é”™è¯¯
      }

      // è§£æå¤šè¡ŒAPIå¯†é’¥æ–‡æœ¬
      function parseApiKeys(text) {
        if (!text || !text.trim()) {
          return []
        }

        // ä½¿ç”¨å¤šç§åˆ†éš”ç¬¦ï¼šæ¢è¡Œã€ç©ºæ ¼ã€é€—å·ã€åˆ†å·
        const keys = text
          .split(/[\n\r\s,;]+/) // æŒ‰æ¢è¡Œã€ç©ºæ ¼ã€é€—å·ã€åˆ†å·åˆ†å‰²
          .map((key) => key.trim()) // å»é™¤é¦–å°¾ç©ºæ ¼
          .filter((key) => key.length > 0) // è¿‡æ»¤ç©ºå­—ç¬¦ä¸²
          .filter((key, index, arr) => arr.indexOf(key) === index) // å»é‡

        return keys
      }

      // è§£ææ‰‹åŠ¨æ¨¡å‹åˆ—è¡¨
      function parseManualModels(text) {
        if (!text || !text.trim()) {
          return []
        }

        const models = text
          .split(/[\n\r]+/) // æŒ‰æ¢è¡Œåˆ†å‰²
          .map((model) => model.trim()) // å»é™¤é¦–å°¾ç©ºæ ¼
          .filter((model) => model.length > 0) // è¿‡æ»¤ç©ºå­—ç¬¦ä¸²
          .filter((model, index, arr) => arr.indexOf(model) === index) // å»é‡

        return models
      }

      document.getElementById('aiSiteForm').addEventListener('submit', async function (e) {
        e.preventDefault()

        const submitBtn = document.getElementById('submitBtn')
        const loading = document.getElementById('loading')
        const result = document.getElementById('result')

        // æ”¶é›†è¡¨å•æ•°æ®
        const baseUrl = document.getElementById('baseUrl').value.trim()

        // æ”¶é›†é€‰ä¸­çš„ channelTypes
        const channelTypeCheckboxes = document.querySelectorAll('input[name="channelTypes"]:checked')
        const channelTypes = Array.from(channelTypeCheckboxes).map((cb) => cb.value)

        if (channelTypes.length === 0) {
          alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§APIæ ¼å¼ç±»å‹')
          return
        }

        // é€šè¿‡APIè·å–ç«™ç‚¹åç§°
        let siteName
        try {
          const response = await fetch('/api/preview-site-name', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ baseUrl }),
          })

          const data = await response.json()

          if (response.ok) {
            siteName = data.siteName
          } else {
            alert('æ— æ³•ç”Ÿæˆç«™ç‚¹åç§°: ' + (data.error || 'æœªçŸ¥é”™è¯¯'))
            return
          }
        } catch (error) {
          alert('è·å–ç«™ç‚¹åç§°å¤±è´¥: ' + error.message)
          return
        }

        // è§£æå¤šè¡ŒAPIå¯†é’¥æ–‡æœ¬
        const apiKeysText = document.getElementById('apiKeys').value
        const apiKeys = parseApiKeys(apiKeysText)

        // è§£ææ‰‹åŠ¨æ¨¡å‹åˆ—è¡¨
        const manualModelsText = document.getElementById('manualModels').value
        const manualModels = parseManualModels(manualModelsText)

        // æ”¶é›†è‡ªå®šä¹‰éªŒè¯ç«¯ç‚¹
        const customValidationEndpoints = {}
        channelTypes.forEach((type) => {
          const input = document.getElementById(`validationEndpoint_${type}`)
          if (input && input.value.trim()) {
            customValidationEndpoints[type] = input.value.trim()
          }
        })

        if (apiKeys.length === 0) {
          alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªAPIå¯†é’¥')
          return
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        submitBtn.disabled = true
        loading.style.display = 'block'
        result.style.display = 'none'

        try {
          const response = await fetch('/api/process-ai-site', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              siteName,
              baseUrl,
              apiKeys,
              channelTypes,
              customValidationEndpoints, // ä½¿ç”¨æ–°çš„å¯¹è±¡
              models: manualModels.length > 0 ? manualModels : undefined, // åªæœ‰åœ¨æœ‰æ‰‹åŠ¨æ¨¡å‹æ—¶æ‰å‘é€
            }),
          })

          const data = await response.json()

          if (data.success) {
            result.className = 'result success'

            // æ„å»ºåˆ†ç±»çš„æ¨¡å‹åˆ—è¡¨HTML
            let modelsHtml = '';
            const modelsByChannel = data.data.modelsByChannel;
            for (const channelType in modelsByChannel) {
                if (modelsByChannel[channelType].length > 0) {
                    modelsHtml += `<h4>${channelType.charAt(0).toUpperCase() + channelType.slice(1)} æ ¼å¼æ¨¡å‹:</h4>`;
                    modelsHtml += '<ul style="margin-left: 20px; margin-top: 5px; margin-bottom: 15px;">';
                    modelsByChannel[channelType].forEach(model => {
                        modelsHtml += `<li>${model}</li>`;
                    });
                    modelsHtml += '</ul>';
                }
            }

            result.innerHTML = `
                        <h3>âœ… é…ç½®æˆåŠŸï¼</h3>
                        <p><strong>ç«™ç‚¹åç§°:</strong> ${data.data.siteName}</p>
                        <p><strong>APIæ ¼å¼:</strong> ${data.data.channelTypes.join(', ')}</p>
                        <p><strong>åˆ›å»ºåˆ†ç»„:</strong> ${data.data.groupsCreated} ä¸ª</p>
                        <p><strong>å‘ç°æ¨¡å‹:</strong> ${data.data.modelsCount} ä¸ª ${
              data.data.usingManualModels ? '(æ‰‹åŠ¨æŒ‡å®š)' : '(è‡ªåŠ¨è·å–)'
            }</p>
                        <p><strong>æ¨¡å‹åˆ—è¡¨:</strong></p>
                        <div style="margin-left: 20px; margin-top: 10px;">
                            ${modelsHtml}
                        </div>
                        <p style="margin-top: 15px; color: #28a745;">
                            <strong>âœ¨ ç°åœ¨å¯ä»¥é€šè¿‡ uni-api è®¿é—®è¿™äº›æ¨¡å‹äº†ï¼</strong>
                        </p>
                    `
          } else {
            throw new Error(data.error || 'é…ç½®å¤±è´¥')
          }
        } catch (error) {
          result.className = 'result error'
          result.innerHTML = `
                    <h3>âŒ é…ç½®å¤±è´¥</h3>
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                    <p>è¯·æ£€æŸ¥è¾“å…¥çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œæˆ–æŸ¥çœ‹æ§åˆ¶å°è·å–æ›´å¤šè¯¦æƒ…ã€‚</p>
                `
        } finally {
          submitBtn.disabled = false
          loading.style.display = 'none'
          result.style.display = 'block'
        }
      })

      // é¡µé¢åŠ è½½æ—¶æ·»åŠ ä¸€äº›ç¤ºä¾‹æç¤º
      document.addEventListener('DOMContentLoaded', function () {
        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        fetch('/api/health')
          .then((response) => response.json())
          .then((data) => {
            console.log('âœ… uni-load æœåŠ¡è¿è¡Œæ­£å¸¸')
          })
          .catch((error) => {
            console.error('âŒ uni-load æœåŠ¡è¿æ¥å¤±è´¥:', error)
          })

        // åˆå§‹åŒ–åŒæ­¥çŠ¶æ€
        refreshSyncStatus()

        // åˆå§‹åŒ–ä¸´æ—¶åˆ†ç»„ç»Ÿè®¡
        refreshTempGroupsStats()

        // åˆå§‹åŒ–æ¸ é“å¥åº·çŠ¶æ€
        refreshChannelHealthStatus()

        // åˆå§‹åŒ–éªŒè¯ç«¯ç‚¹å¸®åŠ©ä¿¡æ¯
        updateValidationEndpointHelp()
      })

      // åˆ·æ–°åŒæ­¥çŠ¶æ€
      async function refreshSyncStatus() {
        try {
          const response = await fetch('/api/status')
          const data = await response.json()
          updateSyncStatusDisplay(data.modelSync)
        } catch (error) {
          document.getElementById('syncStatus').innerHTML = '<p style="color: #dc3545;">âŒ æ— æ³•è·å–åŒæ­¥çŠ¶æ€</p>'
        }
      }

      // ä¸´æ—¶åˆ†ç»„æ¸…ç†ç›¸å…³å‡½æ•°
      // åˆ·æ–°ä¸´æ—¶åˆ†ç»„ç»Ÿè®¡
      async function refreshTempGroupsStats() {
        try {
          const response = await fetch('/api/temp-groups/stats')
          const data = await response.json()

          if (data.success) {
            updateTempGroupsStatusDisplay(data.data)
          } else {
            document.getElementById('tempGroupsStatus').innerHTML =
              '<p style="color: #dc3545;">âŒ è·å–ç»Ÿè®¡å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</p>'
          }
        } catch (error) {
          document.getElementById('tempGroupsStatus').innerHTML =
            '<p style="color: #dc3545;">âŒ æ— æ³•è·å–ä¸´æ—¶åˆ†ç»„ç»Ÿè®¡</p>'
        }
      }

      // æ›´æ–°ä¸´æ—¶åˆ†ç»„çŠ¶æ€æ˜¾ç¤º
      function updateTempGroupsStatusDisplay(stats) {
        const statusEl = document.getElementById('tempGroupsStatus')

        if (stats.totalTempGroups === 0) {
          statusEl.innerHTML = '<p style="color: #28a745;">âœ… æ— ä¸´æ—¶åˆ†ç»„éœ€è¦æ¸…ç†</p>'
          return
        }

        let html = `
          <p>å‘ç° <strong>${stats.totalTempGroups}</strong> ä¸ªä¸´æ—¶åˆ†ç»„éœ€è¦æ¸…ç†</p>
          <div style="margin-top: 10px;">
        `

        stats.instanceStats.forEach((instance) => {
          if (instance.tempGroups.length > 0) {
            html += `
              <div style="margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                <strong>${instance.instanceName}:</strong> ${instance.tempGroups.length} ä¸ªåˆ†ç»„
                <div style="font-size: 0.9em; margin-top: 4px;">
            `

            instance.tempGroups.forEach((group) => {
              const isDebug = group.name.startsWith('debug-models-')
              const icon = isDebug ? 'ğŸ› ï¸' : 'ğŸ§ª'
              html += `<div>${icon} ${group.name} (ID: ${group.id})</div>`
            })

            html += '</div></div>'
          }
        })

        html += '</div>'
        statusEl.innerHTML = html
      }

      // æ¸…ç†æ‰€æœ‰ä¸´æ—¶åˆ†ç»„
      async function cleanupAllTempGroups() {
        if (!confirm("æ‚¨ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ä¸´æ—¶åˆ†ç»„å—ï¼Ÿ\n\nè¿™å°†åˆ é™¤æ‰€æœ‰ä»¥ 'temp-test-' å’Œ 'debug-models-' å¼€å¤´çš„åˆ†ç»„ã€‚")) {
          return
        }

        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'æ¸…ç†ä¸­...'

          const response = await fetch('/api/temp-groups/cleanup', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            setTimeout(refreshTempGroupsStats, 1000) // 1ç§’ååˆ·æ–°çŠ¶æ€
          } else {
            throw new Error(data.error || 'æ¸…ç†å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ¸…ç†å¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // æ¸…ç†è¿‡æœŸä¸´æ—¶åˆ†ç»„ï¼ˆ24å°æ—¶å‰åˆ›å»ºçš„ï¼‰
      async function cleanupOldTempGroups() {
        if (!confirm('æ‚¨ç¡®å®šè¦æ¸…ç†24å°æ—¶å‰åˆ›å»ºçš„ä¸´æ—¶åˆ†ç»„å—ï¼Ÿ\n\nè¿™å°†åˆ é™¤åˆ›å»ºæ—¶é—´è¶…è¿‡24å°æ—¶çš„ä¸´æ—¶åˆ†ç»„ã€‚')) {
          return
        }

        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'æ¸…ç†ä¸­...'

          const response = await fetch('/api/temp-groups/cleanup-old', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ hoursOld: 24 }),
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            setTimeout(refreshTempGroupsStats, 1000) // 1ç§’ååˆ·æ–°çŠ¶æ€
          } else {
            throw new Error(data.error || 'æ¸…ç†å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ¸…ç†å¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
      function updateSyncStatusDisplay(syncStatus) {
        const statusDiv = document.getElementById('syncStatus')
        const controlBtn = document.getElementById('syncControlBtn')

        if (!syncStatus) {
          statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ åŒæ­¥æœåŠ¡ä¸å¯ç”¨</p>'
          return
        }

        let statusIndicator = ''
        let statusText = ''

        if (syncStatus.isRunning) {
          statusIndicator = '<span class="status-indicator status-running"></span>'
          statusText = 'æ­£åœ¨åŒæ­¥ä¸­...'
        } else if (syncStatus.hasInterval) {
          statusIndicator = '<span class="status-indicator status-idle"></span>'
          statusText = `æœåŠ¡è¿è¡Œä¸­ï¼Œæ¯ ${syncStatus.intervalMinutes} åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡`
          if (syncStatus.nextSync) {
            statusText += `<br><small>ä¸‹æ¬¡åŒæ­¥: ${new Date(syncStatus.nextSync).toLocaleString()}</small>`
          }
        } else {
          statusIndicator = '<span class="status-indicator status-stopped"></span>'
          statusText = 'æœåŠ¡å·²åœæ­¢'
        }

        statusDiv.innerHTML = `
                <p>${statusIndicator}${statusText}</p>
                <p><small>åŒæ­¥é—´éš”: ${syncStatus.intervalMinutes} åˆ†é’Ÿ</small></p>
            `

        // æ›´æ–°æ§åˆ¶æŒ‰é’®
        controlBtn.textContent = syncStatus.hasInterval ? 'åœæ­¢æœåŠ¡' : 'å¯åŠ¨æœåŠ¡'
        controlBtn.style.background = syncStatus.hasInterval ? '#dc3545' : '#28a745'
      }

      // æ‰‹åŠ¨è§¦å‘åŒæ­¥
      async function triggerManualSync() {
        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'åŒæ­¥ä¸­...'

          const response = await fetch('/api/sync-models', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            setTimeout(refreshSyncStatus, 2000) // 2ç§’ååˆ·æ–°çŠ¶æ€
          } else {
            throw new Error(data.error || 'åŒæ­¥å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ‰‹åŠ¨åŒæ­¥å¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // åˆ‡æ¢åŒæ­¥æœåŠ¡çŠ¶æ€
      async function toggleSyncService() {
        const btn = document.getElementById('syncControlBtn')
        const isRunning = btn.textContent === 'åœæ­¢æœåŠ¡'
        const action = isRunning ? 'stop' : 'start'

        try {
          btn.disabled = true

          const response = await fetch('/api/sync-models/control', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ action }),
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            refreshSyncStatus()
          } else {
            throw new Error(data.error || 'æ“ä½œå¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ“ä½œå¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
        }
      }

      // æ¸…ç†å¹¶é‡ç½®æ‰€æœ‰æ¨¡å‹é…ç½®
      async function cleanupAndResetModels() {
        if (
          !confirm(
            'æ‚¨ç¡®å®šè¦æ¸…ç†æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æ¨¡å‹åˆ†ç»„å’Œç›¸å…³çš„uni-apié…ç½®å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯é€†ï¼Œé€šå¸¸ç”¨äºé‡ç½®æˆ–è§£å†³é…ç½®æ··ä¹±é—®é¢˜ã€‚'
          )
        ) {
          return
        }

        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'æ¸…ç†ä¸­...'

          const response = await fetch('/api/maintenance/delete-model-groups', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
          })

          const data = await response.json()

          if (data.success) {
            let successMsg = `âœ… ${data.message}\n\n`
            successMsg += `åˆ é™¤çš„åˆ†ç»„: ${data.results.deletedGroups}\n`

            // å¦‚æœæœ‰å¤±è´¥çš„åˆ†ç»„ï¼Œä¹Ÿæ˜¾ç¤ºå‡ºæ¥
            if (data.results.failedGroups > 0) {
              successMsg += `å¤±è´¥çš„åˆ†ç»„: ${data.results.failedGroups}`
            }

            alert(successMsg)

            // æˆåŠŸååˆ·æ–°çŠ¶æ€
            refreshSyncStatus()
          } else {
            throw new Error(data.error || 'æ¸…ç†å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ¸…ç†æ“ä½œå¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // === æ¸ é“å¥åº·ç›‘æ§åŠŸèƒ½ ===

      // åˆ·æ–°æ¸ é“å¥åº·çŠ¶æ€
      async function refreshChannelHealthStatus() {
        try {
          // è·å–æœåŠ¡çŠ¶æ€
          const statusResponse = await fetch('/api/status')
          const statusData = await statusResponse.json()
          updateChannelHealthDisplay(statusData.channelHealth)

          // è·å–ç«™ç‚¹åˆ†ç»„åˆ—è¡¨
          const channelsResponse = await fetch('/api/channels/site-groups')
          const channelsData = await channelsResponse.json()
          if (channelsData.siteGroups) {
            updateChannelListDisplay(channelsData.siteGroups)
          }
        } catch (error) {
          document.getElementById('channelHealthStatus').innerHTML =
            '<p style="color: #dc3545;">âŒ æ— æ³•è·å–å¥åº·ç›‘æ§çŠ¶æ€</p>'
        }
      }

      // æ›´æ–°æ¸ é“å¥åº·çŠ¶æ€æ˜¾ç¤º
      function updateChannelHealthDisplay(healthStatus) {
        const statusDiv = document.getElementById('channelHealthStatus')
        const controlBtn = document.getElementById('healthControlBtn')

        if (!healthStatus) {
          statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ å¥åº·ç›‘æ§æœåŠ¡ä¸å¯ç”¨</p>'
          return
        }

        let statusIndicator = ''
        let statusText = ''

        if (healthStatus.isRunning) {
          statusIndicator = '<span class="status-indicator status-running"></span>'
          statusText = 'æ­£åœ¨æ£€æŸ¥æ¸ é“å¥åº·...'
        } else if (healthStatus.hasInterval) {
          statusIndicator = '<span class="status-indicator status-idle"></span>'
          statusText = `ç›‘æ§è¿è¡Œä¸­ï¼Œæ¯ ${healthStatus.intervalMinutes} åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡`
          if (healthStatus.nextCheck) {
            statusText += `<br><small>ä¸‹æ¬¡æ£€æŸ¥: ${new Date(healthStatus.nextCheck).toLocaleString()}</small>`
          }
        } else {
          statusIndicator = '<span class="status-indicator status-stopped"></span>'
          statusText = 'ç›‘æ§å·²åœæ­¢'
        }

        let failureInfo = ''
        if (healthStatus.failureCount > 0) {
          failureInfo = `<br><span style="color: #dc3545;"><small>âš ï¸ ${healthStatus.failureCount} ä¸ªæ¸ é“å­˜åœ¨å¤±è´¥è®°å½•</small></span>`
        }

        statusDiv.innerHTML = `
                <p>${statusIndicator}${statusText}${failureInfo}</p>
                <p><small>å¤±è´¥é˜ˆå€¼: ${healthStatus.failureThreshold} æ¬¡ï¼Œæ£€æŸ¥é—´éš”: ${healthStatus.intervalMinutes} åˆ†é’Ÿ</small></p>
            `

        // æ›´æ–°æ§åˆ¶æŒ‰é’®
        controlBtn.textContent = healthStatus.hasInterval ? 'åœæ­¢ç›‘æ§' : 'å¯åŠ¨ç›‘æ§'
        controlBtn.style.background = healthStatus.hasInterval ? '#dc3545' : '#28a745'
      }

      // æ›´æ–°æ¸ é“åˆ—è¡¨æ˜¾ç¤º
      function updateChannelListDisplay(channels) {
        const container = document.getElementById('channelListContainer')
        if (channels.length === 0) {
          container.innerHTML = '<p><small>æš‚æ— å·²é…ç½®çš„æ¸ é“åˆ†ç»„ã€‚</small></p>'
          return
        }

        let html = '<h4>å·²é…ç½®çš„æ¸ é“åˆ†ç»„:</h4>'
        html += '<div class="channels-list">'

        channels.forEach((channel) => {
          // ä»æ¸ é“åç§°è§£æä¿¡æ¯
          const parts = channel.name.split('-')
          const channelType = parts[parts.length - 1]
          const siteName = parts.slice(0, -1).join('-')

          html += `
            <div class="channel-item">
                <div class="channel-info">
                    <div class="channel-name">
                        <strong>${channel.name}</strong>
                        <span class="channel-type-badge ${channelType.toLowerCase()}" data-type="${channelType.toLowerCase()}">${channelType.toUpperCase()}</span>
                    </div>
                    <div class="channel-details">
                        <span class="detail-item">ğŸ“ ç«™ç‚¹: ${siteName}</span>
                        <span class="detail-item">ğŸ–¥ï¸ å®ä¾‹: ${channel._instance.name}</span>
                        <span class="detail-item">ğŸ”— ä¸Šæ¸¸: ${channel.upstreams?.[0]?.url || 'N/A'}</span>
                    </div>
                    <div class="channel-actions">
                        <div class="channel-action-group channel-reassign-group">
                            <button class="btn-promote" onclick="reassignChannel('${channel.name}', 'promote', event)">â¬†ï¸ æçº§</button>
                            <button class="btn-demote" onclick="reassignChannel('${channel.name}', 'demote', event)">â¬‡ï¸ é™çº§</button>
                        </div>
                        <div class="channel-action-group channel-management-group">
                            <button class="btn-update" onclick="showUpdateChannelModal('${channel.name}', '${
            channel.upstreams?.[0]?.url || ''
          }', '${channelType}')">
                                ğŸ”„ æ›´æ–°
                            </button>
                            <button class="btn-delete" onclick="deleteChannel('${channel.name}', event)">
                                ğŸ—‘ï¸ åˆ é™¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `
        })
        html += '</div>'
        container.innerHTML = html
      }

      // åˆ é™¤æŒ‡å®šæ¸ é“
      async function deleteChannel(channelName, event) {
        if (
          !confirm(
            `æ‚¨ç¡®å®šè¦å½»åº•åˆ é™¤æ¸ é“ "${channelName}" å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åŒæ—¶ï¼š\n1. åˆ é™¤æ­¤æ¸ é“åˆ†ç»„ã€‚\n2. ä»æ‰€æœ‰æ¨¡å‹åˆ†ç»„ä¸­ç§»é™¤å¯¹æ­¤æ¸ é“çš„å¼•ç”¨ã€‚\n\næ“ä½œä¸å¯é€†ï¼`
          )
        ) {
          return
        }

        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'åˆ é™¤ä¸­...'

          const response = await fetch(`/api/channels/${channelName}`, {
            method: 'DELETE',
          })

          const data = await response.json()

          if (data.success) {
            let alertMsg = `âœ… æ¸ é“ "${channelName}" å·²æˆåŠŸåˆ é™¤ã€‚\n\n`
            alertMsg += `æ›´æ–°çš„æ¨¡å‹åˆ†ç»„: ${data.data.updatedModelGroups.length}\n`
            alertMsg += `åˆ é™¤çš„æ¨¡å‹åˆ†ç»„: ${data.data.deletedModelGroups.length}`
            alert(alertMsg)
            // åˆ·æ–°åˆ—è¡¨
            refreshChannelHealthStatus()
          } else {
            throw new Error(data.message || 'åˆ é™¤å¤±è´¥')
          }
        } catch (error) {
          alert(`âŒ åˆ é™¤æ¸ é“ "${channelName}" å¤±è´¥: ${error.message}`)
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // é‡æ–°åˆ†é…æ¸ é“å®ä¾‹
      async function reassignChannel(channelName, action, event) {
        const actionText = action === 'promote' ? 'æçº§' : 'é™çº§'
        if (!confirm(`æ‚¨ç¡®å®šè¦å¯¹æ¸ é“ "${channelName}" æ‰§è¡Œ ${actionText} æ“ä½œå—ï¼Ÿ\n\nè¿™å°†å°è¯•å°†å…¶åˆ†é…åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨å®ä¾‹ã€‚`)) {
          return
        }

        const btn = event.target
        const originalText = btn.innerHTML

        try {
          btn.disabled = true
          btn.innerHTML = 'å¤„ç†ä¸­...'

          const response = await fetch('/api/channels/reassign', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ channelName, action }),
          })

          const data = await response.json()

          if (data.success) {
            alert(`âœ… ${data.message}`)
            refreshChannelHealthStatus()
          } else {
            throw new Error(data.message || 'æ“ä½œå¤±è´¥')
          }
        } catch (error) {
          alert(`âŒ ${actionText}å¤±è´¥: ${error.message}`)
        } finally {
          btn.disabled = false
          btn.innerHTML = originalText
        }
      }

      // æ‰‹åŠ¨è§¦å‘æ¸ é“å¥åº·æ£€æŸ¥
      async function triggerChannelCheck() {
        const btn = event.target
        const originalText = btn.textContent

        try {
          btn.disabled = true
          btn.textContent = 'æ£€æŸ¥ä¸­...'

          const response = await fetch('/api/check-channels', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            setTimeout(refreshChannelHealthStatus, 2000)
          } else {
            throw new Error(data.error || 'æ£€æŸ¥å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ‰‹åŠ¨å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
          btn.textContent = originalText
        }
      }

      // åˆ‡æ¢æ¸ é“å¥åº·ç›‘æ§æœåŠ¡çŠ¶æ€
      async function toggleHealthMonitor() {
        const btn = document.getElementById('healthControlBtn')
        const isRunning = btn.textContent === 'åœæ­¢ç›‘æ§'
        const action = isRunning ? 'stop' : 'start'

        try {
          btn.disabled = true

          const response = await fetch('/api/check-channels/control', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ action }),
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            refreshChannelHealthStatus()
          } else {
            throw new Error(data.error || 'æ“ä½œå¤±è´¥')
          }
        } catch (error) {
          alert('âŒ æ“ä½œå¤±è´¥: ' + error.message)
        } finally {
          btn.disabled = false
        }
      }

      // æ˜¾ç¤ºå¤±è´¥çš„æ¸ é“
      async function showFailedChannels() {
        try {
          const response = await fetch('/api/failed-channels')
          const data = await response.json()

          if (data.failedChannels.length === 0) {
            alert('âœ… å½“å‰æ²¡æœ‰å¤±è´¥çš„æ¸ é“')
            return
          }

          let message = 'ğŸš¨ å¤±è´¥çš„æ¸ é“åˆ—è¡¨:\n\n'
          data.failedChannels.forEach((channel) => {
            message += `â€¢ ${channel.name}: ${channel.failures}/${channel.threshold} æ¬¡å¤±è´¥`
            if (channel.willBeRemoved) {
              message += ' (å°†è¢«ç§»é™¤)'
            }
            message += '\n'
          })

          message += '\næ˜¯å¦è¦é‡ç½®æ‰€æœ‰å¤±è´¥è®¡æ•°?'

          if (confirm(message)) {
            await resetAllChannelFailures()
          }
        } catch (error) {
          alert('âŒ è·å–å¤±è´¥æ¸ é“åˆ—è¡¨å¤±è´¥: ' + error.message)
        }
      }

      // é‡ç½®æ‰€æœ‰æ¸ é“å¤±è´¥è®¡æ•°
      async function resetAllChannelFailures() {
        try {
          const response = await fetch('/api/reset-channel-failures', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({}),
          })

          const data = await response.json()

          if (data.success) {
            alert('âœ… ' + data.message)
            refreshChannelHealthStatus()
          } else {
            throw new Error(data.error || 'é‡ç½®å¤±è´¥')
          }
        } catch (error) {
          alert('âŒ é‡ç½®å¤±è´¥: ' + error.message)
        }
      }
      // æ˜¾ç¤ºæ›´æ–°æ¸ é“æ¨¡æ€æ¡†
      function showUpdateChannelModal(channelName, baseUrl, channelType) {
        document.getElementById('updateChannelName').value = channelName
        document.getElementById('updateOriginalBaseUrl').value = baseUrl
        document.getElementById('updateChannelType').value = channelType

        document.getElementById('updateChannelDisplayName').textContent = channelName
        document.getElementById('updateBaseUrlDisplay').textContent = baseUrl

        // æ¸…ç©ºAPIå¯†é’¥æ–‡æœ¬æ¡†
        document.getElementById('updateApiKeys').value = ''

        document.getElementById('updateChannelModal').style.display = 'block'
      }

      // å…³é—­æ›´æ–°æ¨¡æ€æ¡†
      function closeUpdateModal() {
        document.getElementById('updateChannelModal').style.display = 'none'
      }

      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      window.onclick = function (event) {
        const modal = document.getElementById('updateChannelModal')
        if (event.target === modal) {
          closeUpdateModal()
        }
      }

      // å¤„ç†æ›´æ–°è¡¨å•æäº¤
      document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('updateChannelForm').addEventListener('submit', async function (e) {
          e.preventDefault()

          const channelName = document.getElementById('updateChannelName').value
          const baseUrl = document.getElementById('updateOriginalBaseUrl').value
          const channelType = document.getElementById('updateChannelType').value
          const apiKeysText = document.getElementById('updateApiKeys').value.trim()

          // å¦‚æœAPIå¯†é’¥ä¸ºç©ºï¼Œè®¾ç½®ä¸ºç©ºæ•°ç»„ï¼Œåç«¯ä¼šè·³è¿‡å¯†é’¥æ›´æ–°
          let apiKeys = []
          if (apiKeysText) {
            apiKeys = parseApiKeys(apiKeysText)
            if (apiKeys.length === 0) {
              alert('APIå¯†é’¥æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥')
              return
            }
          }

          const submitBtn = e.target.querySelector('button[type="submit"]')
          const originalText = submitBtn.textContent

          try {
            submitBtn.disabled = true
            submitBtn.textContent = 'æ›´æ–°ä¸­...'

            // æ„å»ºè¯·æ±‚ä½“ï¼Œæ˜ç¡®æŒ‡å®šç›®æ ‡åˆ†ç»„å’Œæ“ä½œç±»å‹
            const requestBody = {
              baseUrl: baseUrl,
              channelTypes: [channelType],
              targetChannelName: channelName,  // æ˜ç¡®æŒ‡å®šè¦æ›´æ–°çš„åˆ†ç»„
              operationType: 'update'          // æ˜ç¡®æŒ‡å®šä¸ºæ›´æ–°æ“ä½œ
            }

            // åªæœ‰åœ¨ç”¨æˆ·è¾“å…¥äº†æ–°å¯†é’¥æ—¶æ‰æ·»åŠ åˆ°è¯·æ±‚ä¸­
            if (apiKeys.length > 0) {
              requestBody.apiKeys = apiKeys
            }

            const response = await fetch('/api/process-ai-site', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestBody),
            })

            const data = await response.json()

            if (data.success) {
              let successMsg = `âœ… æ¸ é“ ${channelName} æ›´æ–°æˆåŠŸï¼\n\n`

              if (apiKeys.length > 0) {
                successMsg += `æ–°å¢çš„å¯†é’¥æ•°é‡: ${apiKeys.length}\n`
              } else {
                successMsg += `ä¿æŒç°æœ‰APIå¯†é’¥ä¸å˜\n`
              }

              successMsg += `æ¨¡å‹æ•°é‡: ${data.data.modelsCount}\n\n`

              // æ·»åŠ åˆ†ç±»æ¨¡å‹ä¿¡æ¯
              const modelsByChannel = data.data.modelsByChannel;
              for (const channelType in modelsByChannel) {
                if (modelsByChannel[channelType].length > 0) {
                  successMsg += `${channelType.charAt(0).toUpperCase() + channelType.slice(1)} æ ¼å¼: ${modelsByChannel[channelType].length} ä¸ªæ¨¡å‹\n`;
                }
              }

              alert(successMsg)

              // å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°åˆ—è¡¨
              closeUpdateModal()
              refreshChannelHealthStatus()
            } else {
              throw new Error(data.error || 'æ›´æ–°å¤±è´¥')
            }
          } catch (error) {
            alert(`âŒ æ›´æ–°æ¸ é“å¤±è´¥: ${error.message}`)
          } finally {
            submitBtn.disabled = false
            submitBtn.textContent = originalText
          }
        })
      })
    </script>
  </body>
</html>
